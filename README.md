# GrabVidZilla

–ö—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –≤–∏–¥–µ–æ —Å —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º (YouTube, VK, Instagram, TikTok –∏ –¥—Ä.).

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üé• –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º (—á–µ—Ä–µ–∑ yt-dlp)
- üíª CLI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (click + rich): –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä, —Å–∫–æ—Ä–æ—Å—Ç—å —Å–∫–∞—á–∏–≤–∞–Ω–∏—è, —Ü–≤–µ—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ —ç–º–æ–¥–∑–∏
- üñ•Ô∏è –ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (Streamlit): –∞–Ω–∞–ª–∏–∑ —Ñ–æ—Ä–º–∞—Ç–æ–≤, –≤—ã–±–æ—Ä –∫–∞—á–µ—Å—Ç–≤–∞ –∏ —Å—É–±—Ç–∏—Ç—Ä–æ–≤, –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ –∫–Ω–æ–ø–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- üß© –ü–æ–¥–¥–µ—Ä–∂–∫–∞ cookies.txt (Netscape) –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö/—Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –≤–∏–¥–µ–æ (VK/YouTube –∏ –¥—Ä.)
- üê≥ Docker-–æ–±—Ä–∞–∑ (–≤–∫–ª—é—á–∞–µ—Ç ffmpeg)

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.11+
- ffmpeg (–≤ —Å–∏—Å—Ç–µ–º–µ) ‚Äî –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞; –≤ Docker —Å—Ç–∞–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∞–∫—Ç—É–∞–ª—å–Ω—ã–π `yt-dlp` (–≤ –ø—Ä–æ–µ–∫—Ç–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω –≤ `requirements.txt`)
- –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (Python): `yt-dlp`, `streamlit`, `click`, `rich`, `requests` (—Å–º. `requirements.txt`)

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ (–ª–æ–∫–∞–ª—å–Ω–æ)

1) –°–æ–∑–¥–∞–π—Ç–µ –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ venv:
```bash
python -m venv .venv
# Windows PowerShell:
.\.venv\Scripts\Activate.ps1
# Linux/Mac:
# source .venv/bin/activate
```

2) –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
pip install -r requirements.txt
```

3) –î–æ–±–∞–≤—å—Ç–µ ffmpeg –≤ PATH (–µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Å–∏—Å—Ç–µ–º–Ω–æ):
- Windows (–ø—Ä–∏–º–µ—Ä): –¥–æ–±–∞–≤—å—Ç–µ –ø—É—Ç—å –∫ –±–∏–Ω–∞—Ä–Ω–∏–∫—É –≤ PATH —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏.
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Docker (–Ω–∏–∂–µ) ‚Äî —Ç–∞–º ffmpeg —É–∂–µ —Å—Ç–∞–≤–∏—Ç—Å—è.

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: UI (Streamlit)

–õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞ (–ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π):

```bash
# –≤–∞—Ä–∏–∞–Ω—Ç A
streamlit run ui/app.py

# –≤–∞—Ä–∏–∞–Ω—Ç B (—ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ)
python -m streamlit run ui/app.py
```

–û—Ç–∫—Ä–æ–µ—Ç—Å—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ –∞–¥—Ä–µ—Å—É `http://localhost:8501`.

- –û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ —Ä–∞–±–æ—Ç—ã:
  - –í–≤–µ–¥–∏—Ç–µ URL –≤–∏–¥–µ–æ.
  - –ù–∞–∂–º–∏—Ç–µ ¬´Analysis¬ª ‚Äî –ø–æ–ª—É—á–∏–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–∞—á–µ—Å—Ç–≤ –∏ —è–∑—ã–∫–æ–≤ —Å—É–±—Ç–∏—Ç—Ä–æ–≤.
  - –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ –∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) —è–∑—ã–∫ —Å—É–±—Ç–∏—Ç—Ä–æ–≤.
  - –ù–∞–∂–º–∏—Ç–µ ¬´Download¬ª ‚Äî –ø–æ–π–¥—ë—Ç –∑–∞–≥—Ä—É–∑–∫–∞ —Å –ø—Ä–æ–≥—Ä–µ—Å—Å‚Äë–±–∞—Ä–æ–º –∏ —Å–∫–æ—Ä–æ—Å—Ç—å—é.
  - –ü–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –ø–æ—è–≤–∏—Ç—Å—è –∫–Ω–æ–ø–∫–∞ ¬´–°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª –≤ –±—Ä–∞—É–∑–µ—Ä–µ¬ª –∏ —Ñ–∞–π–ª –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω –Ω–∞ –¥–∏—Å–∫.
- Cookies:
  - –†–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ ¬´Advanced (cookies)¬ª –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª —Ñ–æ—Ä–º–∞—Ç–∞ Netscape (`cookies.txt`).
  - –ï—Å–ª–∏ —Ñ–∞–π–ª —É–∂–µ –ª–µ–∂–∏—Ç –≤ `tools/cookies.txt`, UI –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç –µ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
- –ö–Ω–æ–ø–∫–∞ ¬´Stop server¬ª –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å Streamlit (–∞–Ω–∞–ª–æ–≥ `Ctrl+C`).

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –≤—ã–±–æ—Ä–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –≤ UI:
- ¬´audio only¬ª ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `bestaudio/best`.
- –î–ª—è `<Xp>` UI —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä –≤–∏–¥–∞ `bv*[height<=X]+ba/best[height<=X]`.
- –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ñ–æ–ª–±—ç–∫ –Ω–∞ `best`.

–ì–¥–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ñ–∞–π–ª—ã (UI):
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî –≤ —Å–∏—Å—Ç–µ–º–Ω—É—é –ø–∞–ø–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `~/Downloads` (Windows/Linux/macOS).

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: CLI

–ó–∞–ø—É—Å–∫ –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞:
```bash
python -m cli.cli
```

- –ú–µ–Ω—é:
  - 1. –°–∫–∞—á–∞—Ç—å –≤–∏–¥–µ–æ
  - 2. help
  - 3. –ó–∞–≥—Ä—É–∑–∏—Ç—å cookies (—Å–∫–æ–ø–∏—Ä—É–µ—Ç —É–∫–∞–∑–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –≤ `tools/cookies.txt`)
  - 0. –í—ã—Ö–æ–¥

- –ü—Ä—è–º—ã–µ –ø—Ä–∏–º–µ—Ä—ã:
```bash
python -m cli.cli "https://youtu.be/..." -o ".\Downloads"
python -m cli.cli "https://vkvideo.ru/..." --cookies tools\cookies.txt
```

- –û—Ç–æ–±—Ä–∞–∂–∞–µ–º:
  - –ü—Ä–æ–≥—Ä–µ—Å—Å (0..100%)
  - –¢–µ–∫—É—â—É—é —Å–∫–æ—Ä–æ—Å—Ç—å (–ë/—Å, –ö–ë/—Å, –ú–ë/—Å)
  - –ü–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ ‚Äî –∏–º—è —Ñ–∞–π–ª–∞ –∏ –≤—Ä–µ–º—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è

- –ü—É—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:
  - –ú–µ–Ω—é: `Downloads` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
  - CLI: `-o/--output`, –µ—Å–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω–æ ‚Äî —Ç–∞–∫–∂–µ `Downloads`
  - UI (Streamlit): –ø–∞–ø–∫–∞ –∑–∞–≥—Ä—É–∑–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`~/Downloads`)

## Cookies (Netscape —Ñ–æ—Ä–º–∞—Ç)

–ó–∞—á–µ–º: VK/YouTube —á–∞—Å—Ç–æ —Ç—Ä–µ–±—É—é—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é/—Ä–µ–≥–∏–æ–Ω ‚Üí –±–µ–∑ cookies –≤–æ–∑–º–æ–∂–Ω—ã 403/–æ—à–∏–±–∫–∏.

–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å:
1) –í–æ–π–¥–∏—Ç–µ –Ω–∞ —Å–∞–π—Ç –≤ —Å–≤–æ—ë–º –±—Ä–∞—É–∑–µ—Ä–µ.
2) –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ cookies –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª —Ñ–æ—Ä–º–∞—Ç–∞ Netscape (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è ‚ÄúGet cookies.txt‚Äù –∏–ª–∏ –∞–Ω–∞–ª–æ–≥).
3) –í–∞—Ä–∏–∞–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
   - –ú–µ–Ω—é ‚Üí –ø—É–Ω–∫—Ç 3 ‚Äú–ó–∞–≥—Ä—É–∑–∏—Ç—å cookies‚Äù ‚Üí —É–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å ‚Äî —Ñ–∞–π–ª —Å–∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤ `tools/cookies.txt`; –¥–∞–ª–µ–µ –ø—É–Ω–∫—Ç 1.
   - –ü—Ä—è–º–æ –≤ CLI: `--cookies tools\cookies.txt`.

–í–∞–∂–Ω–æ: —Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª –≤ —Å–µ–∫—Ä–µ—Ç–µ ‚Äî –≤–Ω—É—Ç—Ä–∏ –≤–∞—à–∏ —Å–µ—Å—Å–∏–∏.

## Docker

–°–±–æ—Ä–∫–∞:
```bash
docker build -t grabvidzilla .
```

–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—É—Å–∫–∞:
```bash
# Windows PowerShell: —Å–æ–∑–¥–∞–¥–∏–º –ø–∞–ø–∫—É –¥–ª—è –∑–∞–≥—Ä—É–∑–æ–∫
New-Item -ItemType Directory -Path .\downloads -Force | Out-Null

# –ú–µ–Ω—é (–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ, –Ω—É–∂–µ–Ω -it). –§–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –≤ /data.
docker run --rm -it -v "${PWD}\downloads:/data" grabvidzilla

# –ü—Ä—è–º–æ–π URL ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ /data
docker run --rm -it -v "${PWD}\downloads:/data" grabvidzilla "https://youtu.be/..." -o /data

# –° cookies (—Å–º–æ–Ω—Ç–∏—Ä—É–µ–º cookies.txt –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)
docker run --rm -it -v "${PWD}\downloads:/data" -v "${PWD}\tools\cookies.txt:/app/tools/cookies.txt:ro" \
  grabvidzilla "https://vkvideo.ru/..." -o /data --cookies /app/tools/cookies.txt

# –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–º–æ—â—å
docker run --rm grabvidzilla --help
```

### –ì–¥–µ –ª–µ–∂–∞—Ç —Ñ–∞–π–ª—ã –∏ –∫–∞–∫ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞–ø–∫–∏ (Windows/Linux)

- –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–± ‚Äî —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å—Ä–∞–∑—É –≤ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é –ø–∞–ø–∫—É —Ö–æ—Å—Ç–∞, —á—Ç–æ–±—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞—Å–æ—Ä—è–ª—Å—è.
- –ï—Å—Ç—å –¥–≤–∞ —É–¥–æ–±–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–∞:
  - –°–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ `/data` –∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –µ—ë –Ω–∞ —Ö–æ—Å—Ç–æ–≤—É—é –ø–∞–ø–∫—É.
  - –ò–ª–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ö–æ—Å—Ç–æ–≤—É—é –ø–∞–ø–∫—É –≤ `/app/Downloads` –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º –ø—É—Ç—ë–º –º–µ–Ω—é.

–ü—Ä–∏–º–µ—Ä—ã –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–ø–æ–¥—Å—Ç–∞–≤—å—Ç–µ —Å–≤–æ—é –ø–∞–ø–∫—É):

- Windows PowerShell (–ø—Ä–∏–º–µ—Ä –¥–ª—è `D:\temp\Downloads`):
```powershell
# –í–∞—Ä–∏–∞–Ω—Ç A: —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä—è–º–æ –≤ /data (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—Ä—è–º—ã—Ö –∫–æ–º–∞–Ω–¥)
docker run --rm -it -v "D:\temp\Downloads:/data" grabvidzilla "https://youtu.be/..." -o /data

# –í–∞—Ä–∏–∞–Ω—Ç B: –º–µ–Ω—é —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º –ø—É—Ç—ë–º (–º–µ–Ω—é —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ /app/Downloads)
docker run --rm -it -v "D:\temp\Downloads:/app/Downloads" grabvidzilla
```

- Linux/macOS (–ø—Ä–∏–º–µ—Ä –¥–ª—è `~/temp/Downloads`):
```bash
# –í–∞—Ä–∏–∞–Ω—Ç A: —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä—è–º–æ –≤ /data
docker run --rm -it -v "$HOME/temp/Downloads:/data" grabvidzilla "https://youtu.be/..." -o /data

# –í–∞—Ä–∏–∞–Ω—Ç B: –º–µ–Ω—é —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º –ø—É—Ç—ë–º
docker run --rm -it -v "$HOME/temp/Downloads:/app/Downloads" grabvidzilla
```

–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:
- –ï—Å–ª–∏ —É–∫–∞–∑—ã–≤–∞–µ—Ç–µ `-o /data`, –∏—Ç–æ–≥–æ–≤—ã–π —Ñ–∞–π–ª —Å—Ä–∞–∑—É –ø–æ–ø–∞–¥—ë—Ç –Ω–∞ —Ö–æ—Å—Ç ‚Äî –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–∏—á–µ–≥–æ –ª–∏—à–Ω–µ–≥–æ –Ω–µ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è.
- –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –º–µ–Ω—é –±–µ–∑ `-o`, —Å–º–æ–Ω—Ç–∏—Ä—É–π—Ç–µ —Ö–æ—Å—Ç–æ–≤—É—é –ø–∞–ø–∫—É –≤ `/app/Downloads`, —á—Ç–æ–±—ã —Ñ–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å —Ç—É–¥–∞ –∏ –±—ã–ª–∏ –≤–∏–¥–Ω—ã –Ω–∞ —Ö–æ—Å—Ç–µ.

### –ó–∞–ø—É—Å–∫ UI (Streamlit) –≤ Docker

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ–±—Ä–∞–∑ –∑–∞–ø—É—Å–∫–∞–µ—Ç CLI. –î–ª—è UI –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Ç–æ—á–∫—É –≤—Ö–æ–¥–∞ –∏ –ø—Ä–æ–±—Ä–æ—Å—å—Ç–µ –ø–æ—Ä—Ç 8501.

- Windows PowerShell (–ø—Ä–∏–º–µ—Ä, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞ —Ö–æ—Å—Ç –≤ `D:\temp\Downloads`):
```powershell
docker run --rm -p 8501:8501 `
  --entrypoint streamlit `
  -e HOME=/app `
  -v "D:\temp\Downloads:/app/Downloads" `
  -v "D:\ProjectsLab\GrabVidZilla-V2\tools:/app/tools" `
  grabvidzilla run ui/app.py --server.address=0.0.0.0 --server.port=8501
```

- Linux/macOS (–ø—Ä–∏–º–µ—Ä, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ `~/temp/Downloads`):
```bash
docker run --rm -p 8501:8501 \
  --entrypoint streamlit \
  -e HOME=/app \
  -v "$HOME/temp/Downloads:/app/Downloads" \
  -v "$(pwd)/tools:/app/tools" \
  grabvidzilla run ui/app.py --server.address=0.0.0.0 --server.port=8501
```

–ü–æ—è—Å–Ω–µ–Ω–∏—è:
- –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `HOME=/app` —Å–¥–µ–ª–∞–µ—Ç –¥–æ–º–∞—à–Ω–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–µ–π `/app`, —á—Ç–æ–±—ã UI —Å–æ—Ö—Ä–∞–Ω—è–ª –≤ `/app/Downloads`.
- –°–º–æ–Ω—Ç–∏—Ä—É–π—Ç–µ `tools` –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `cookies.txt` –≤ UI.

### Cookies –≤–Ω—É—Ç—Ä–∏ Docker

–í–∞—Ä–∏–∞–Ω—Ç—ã:
- –°–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª cookies –Ω–∞–ø—Ä—è–º—É—é –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ —É–∫–∞–∑–∞—Ç—å –µ–≥–æ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ:
  - Windows:
  ```powershell
  docker run --rm -it -v "D:\temp\Downloads:/data" -v "D:\ProjectsLab\GrabVidZilla-V2\tools\cookies.txt:/app/tools/cookies.txt:ro" `
    grabvidzilla "https://vkvideo.ru/..." -o /data --cookies /app/tools/cookies.txt
  ```
  - Linux/macOS:
  ```bash
  docker run --rm -it -v "$HOME/temp/Downloads:/data" -v "$(pwd)/tools/cookies.txt:/app/tools/cookies.txt:ro" \
    grabvidzilla "https://vkvideo.ru/..." -o /data --cookies /app/tools/cookies.txt
  ```
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ–Ω—é CLI (–ø—É–Ω–∫—Ç 3 ‚Äú–ó–∞–≥—Ä—É–∑–∏—Ç—å cookies‚Äù):
  - –ß—Ç–æ–±—ã cookies —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å –∏ –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏, —Å–º–æ–Ω—Ç–∏—Ä—É–π—Ç–µ –ø–∞–ø–∫—É `tools` —Ü–µ–ª–∏–∫–æ–º:
    - Windows:
    ```powershell
    docker run --rm -it -v "D:\temp\Downloads:/app/Downloads" -v "D:\ProjectsLab\GrabVidZilla-V2\tools:/app/tools" grabvidzilla
    ```
    - Linux/macOS:
    ```bash
    docker run --rm -it -v "$HOME/temp/Downloads:/app/Downloads" -v "$(pwd)/tools:/app/tools" grabvidzilla
    ```
  - –í –º–µ–Ω—é —É–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ cookies-—Ñ–∞–π–ª—É –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–º–æ–∂–Ω–æ –∫ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–∞–ø–∫–µ), —Ñ–∞–π–ª –±—É–¥–µ—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ `/app/tools/cookies.txt`.

### –í—ã–∑–æ–≤ –º–µ–Ω—é –∏ Help –≤ Docker

- –ú–µ–Ω—é CLI (ENTRYPOINT –∑–∞–ø—É—Å–∫–∞–µ—Ç CLI –±–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤):
```bash
docker run --rm -it grabvidzilla
```
- Help (—Ä–∞–±–æ—Ç–∞–µ—Ç –≤ Docker):
```bash
docker run --rm grabvidzilla --help
```

### –ì–¥–µ Docker —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- Windows (Docker Desktop —Å WSL2): –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –¥–∏—Å–∫ –≤ `%USERPROFILE%\AppData\Local\Docker\wsl\data\ext4.vhdx`
- Linux: `/var/lib/docker`

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
grabvidzilla/
‚îú‚îÄ‚îÄ core/          # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îú‚îÄ‚îÄ cli/           # –ö–æ–º–∞–Ω–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ (click + rich)
‚îú‚îÄ‚îÄ ui/            # –ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (Streamlit)
‚îú‚îÄ‚îÄ tools/         # –í–Ω–µ—à–Ω–∏–µ —É—Ç–∏–ª–∏—Ç—ã, cookies.txt, ffmpeg
‚îú‚îÄ‚îÄ Downloads/     # –ü–∞–ø–∫–∞ –∑–∞–≥—Ä—É–∑–æ–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (CLI –∏ –º–µ–Ω—é)
‚îú‚îÄ‚îÄ tests/         # –¢–µ—Å—Ç—ã
‚îî‚îÄ‚îÄ scripts/       # –£—Ç–∏–ª–∏—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
```

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

- –ú–æ–¥—É–ª—å –ë–î: `core/db.py`
  - SQLite-—Ñ–∞–π–ª –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `data/app.db` (—Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ).
  - –°–æ–¥–µ—Ä–∂–∏—Ç:
    - `engine` ‚Äî –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ SQLite;
    - `SessionLocal` ‚Äî —Ñ–∞–±—Ä–∏–∫–∞ —Å–µ—Å—Å–∏–π;
    - `Base` ‚Äî –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è ORM-–º–æ–¥–µ–ª–µ–π;
    - `init_db()` ‚Äî —Å–æ–∑–¥–∞—ë—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã.
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –ø–∞—Ä–æ–ª–∏: `core/auth.py`
  - ORM-–º–æ–¥–µ–ª—å `User` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –ø–æ–ª—è–º–∏:
    - `id` ‚Äî –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á;
    - `email` ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π e-mail;
    - `name` ‚Äî –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è;
    - `password` ‚Äî –ø–∞—Ä–æ–ª—å **–≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ** (–ø–æ–¥—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π/—É—á–µ–±–Ω–æ–π —Å—Ä–µ–¥—ã);
    - `phone` ‚Äî —Ç–µ–ª–µ—Ñ–æ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ);
    - `is_active: bool` ‚Äî –∞–∫—Ç–∏–≤–µ–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–º–æ–∂–Ω–æ ¬´–≤—ã–∫–ª—é—á–∏—Ç—å¬ª –±–µ–∑ —É–¥–∞–ª–µ–Ω–∏—è);
    - `is_admin: bool` ‚Äî —Ñ–ª–∞–≥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞;
    - `role: str` ‚Äî —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`"root"`, `"admin"` –∏–ª–∏ `"user"`);
    - `created_at` ‚Äî –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è;
    - `updated_at` ‚Äî –¥–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.
  - –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
    - `register_user(db, email, name, password, phone, role, is_admin, is_active)` ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (–≤ UI –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–æ–∑–¥–∞—é—Ç—Å—è –æ–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —Ä–æ–ª—å—é `"user"`);
    - `authenticate_user(db, email, password)` ‚Äî –ª–æ–≥–∏–Ω –ø–æ email/–∏–º–µ–Ω–∏ –∏ –ø–∞—Ä–æ–ª—é (—É—á–∏—Ç—ã–≤–∞–µ—Ç `is_active`);
    - `update_user(db, user_id, ...)` / `deactivate_user(db, user_id)` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π;
    - `user_is_admin(user)` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–≤–∫–ª—é—á–∞—è `root`);
    - `user_is_root(user)` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è;
    - `user_to_dict(user)` ‚Äî —É–¥–æ–±–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è UI/API.
- UI-–æ–±–≤—è–∑–∫–∞: `ui/auth_ui.py`
  - –ë–ª–æ–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–ª–æ–≥–∏–Ω/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è):
    - —Ñ–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ (`email` + `password`);
    - —Ñ–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (`email`, `name`, `password`, `phone`).
  - –í `st.session_state["current_user"]` —Ö—Ä–∞–Ω–∏—Ç—Å—è —Å–ª–æ–≤–∞—Ä—å —Å –ø–æ–ª—è–º–∏:
    - `id`, `email`, `name`, `role`, `is_admin`, `is_active`.
  - –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
    - `render_auth_block()` ‚Äî –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –±–ª–æ–∫ –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ;
    - `require_login()` ‚Äî —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–∞–∑–¥–µ–ª—É (–∏–Ω–∞—á–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ñ–æ—Ä–º—ã –∏ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É);
    - `require_admin()` ‚Äî —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞;
    - `logout()` ‚Äî –≤—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞.
- –í `ui/app.py`:
  - –í –Ω–∞—á–∞–ª–µ `main()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `auth_ui.render_auth_block()` –∏ `auth_ui.require_login()`, —á—Ç–æ–±—ã –¥–æ—Å—Ç—É–ø –∫ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—É –∑–∞–≥—Ä—É–∑–∫–∏ –±—ã–ª —Ç–æ–ª—å–∫–æ —É –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

> **–í–∞–∂–Ω–æ:** –ø–∞—Ä–æ–ª–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –±–µ–∑ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è. –≠—Ç–æ —Å–¥–µ–ª–∞–Ω–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—Ç–ª–∞–¥–∫–∏ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –º–µ–Ω—è—Ç—å –ø–∞—Ä–æ–ª—å –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ SQLite (`data/app.db`). –î–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ –Ω–∞—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π.

#### –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–ü—Ä–∏ —Å–∞–º–æ–º –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ UI (`streamlit run ui/app.py`), –µ—Å–ª–∏ –≤ –±–∞–∑–µ –µ—â—ë –Ω–µ—Ç –Ω–∏ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –≤—ã —É–≤–∏–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ CLI.

–°–¥–µ–ª–∞–π—Ç–µ —ç—Ç–æ –æ–¥–∏–Ω —Ä–∞–∑:

```bash
python scripts/create_first_user.py
```

–°–∫—Ä–∏–ø—Ç:

- —Å–æ–∑–¥–∞—ë—Ç –±–∞–∑—É `data/app.db` (–µ—Å–ª–∏ –µ—ë –µ—â—ë –Ω–µ—Ç);
- –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ —É–∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏;
- –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Äî –≤—ã–≤–æ–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ä–∞–±–æ—Ç—É;
- –µ—Å–ª–∏ –Ω–µ—Ç ‚Äî —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç `email`, `–∏–º—è`, `–ø–∞—Ä–æ–ª—å`, `—Ç–µ–ª–µ—Ñ–æ–Ω` –∏ —Å–æ–∑–¥–∞—ë—Ç –ø–µ—Ä–≤–æ–≥–æ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`role="root"`, `is_admin=True`). –≠—Ç–æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–Ω–∏–∂–µ–Ω/–¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –¥—Ä—É–≥–∏–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ API —è–¥—Ä–∞

- –°–ª–æ–∏:
  - `core/` ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, –Ω–µ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç `cli`/`ui`
  - `cli/` ‚Äî —Ç–æ–ª—å–∫–æ CLI, –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç `core`
  - `ui/` ‚Äî —Ç–æ–ª—å–∫–æ GUI, –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç `core`

- API:
```python
def download_video(
    url: str,
    output_path: str = ".",
    progress_callback: Callable[[float], None] | None = None,
    progress_info_callback: Callable[[dict], None] | None = None,
    cookies_path: str | None = None,
    format: str | None = None,
    audio_only: bool = False,
    subtitle_lang: str | None = None,
) -> str:
    ...
```
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Ç—å –∫ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–º—É —Ñ–∞–π–ª—É.
- `progress_callback`: –ø—Ä–æ—Ü–µ–Ω—Ç—ã (0..100)
- `progress_info_callback`: –¥–µ—Ç–∞–ª–∏ (speed, downloaded_bytes, total_bytes)
- `cookies_path`: –ø—É—Ç—å –∫ cookies.txt (Netscape)

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –¥–ª—è UI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–Ω–∞–ª–∏–∑ –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π:

```python
def analyze_video(
    url: str,
    cookies_path: str | None = None,
) -> tuple[dict, list[str], list[str]]:
    ...
```
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ç–µ–∂:
  - `info`: –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ä–æ–ª–∏–∫–∞ –æ—Ç yt-dlp (–≤–∫–ª—é—á–∞—è `formats`),
  - `qualities`: —Å–ø–∏—Å–æ–∫ —É–¥–æ–±–Ω—ã—Ö –º–µ—Ç–æ–∫ –∫–∞—á–µ—Å—Ç–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `'2160p'`, `'1080p'`, ‚Ä¶, `'audio only'`),
  - `subtitle_langs`: –¥–æ—Å—Ç—É–ø–Ω—ã–µ —è–∑—ã–∫–∏ —Å—É–±—Ç–∏—Ç—Ä–æ–≤ (–∫–æ–¥—ã –≤—Ä–æ–¥–µ `['en', 'ru', ...]`).

## REST API

### –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

–õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞ (–ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π):

```bash
uvicorn api.main:app --reload --host 0.0.0.0 --port 8000
```

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (FastAPI):
- Swagger UI: `http://localhost:8000/docs`
- ReDoc: `http://localhost:8000/redoc`

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é CORS –æ—Ç–∫—Ä—ã—Ç –¥–ª—è –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (–¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏).

### –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

- GET `/health`
  - –û—Ç–≤–µ—Ç: `{"status": "ok"}`

- GET `/formats?url=<HttpUrl>`
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–π `info` –æ—Ç yt-dlp (–≤–∫–ª—é—á–∞—è –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ `formats`).
  - –ö–æ–¥—ã –æ—à–∏–±–æ–∫: `400` (–Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π URL), `422` (–æ—à–∏–±–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–æ–≤).

- POST `/downloads`
  - –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ (JSON):
    ```json
    {
      "url": "https://www.youtube.com/watch?v=...",
      "format": "136+140",
      "audio_only": false
    }
    ```
  - –ü—Ä–∏–º–µ—á–∞–Ω–∏—è:
    - –ï—Å–ª–∏ `audio_only=true`, –ø–∞—Ä–∞–º–µ—Ç—Ä `format` –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è.
    - –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω `format`, API –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –µ–≥–æ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ URL; –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤–µ—Ä–Ω—ë—Ç `422 format_unavailable`.
  - –û—Ç–≤–µ—Ç: `201 Created`
    ```json
    { "id": "TASK_UUID" }
    ```
  - –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏: `400` (–≤–∞–ª–∏–¥–∞—Ü–∏—è), `422` (format_unavailable), `429` (—Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏), `500`.

- GET `/downloads`
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á. –≠–ª–µ–º–µ–Ω—Ç:
    ```json
    {
      "id": "TASK_UUID",
      "url": "https://‚Ä¶",
      "state": "queued|running|completed|failed|cancelled",
      "progress_percent": 42.0,
      "bytes_downloaded": 123456,
      "total_bytes": 999999,
      "speed_bps": 123456.7,
      "eta_s": 12.3,
      "elapsed_s": 45.6,
      "filename": "My Video [abc123].mp4",
      "error": null
    }
    ```

- GET `/downloads/{task_id}`
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∑–∞–¥–∞—á–∏ –≤ —Ç–∞–∫–æ–º –∂–µ —Ñ–æ—Ä–º–∞—Ç–µ, –∫–∞–∫ –≤—ã—à–µ.

- DELETE `/downloads/{task_id}`
  - –û—Ç–º–µ–Ω—è–µ—Ç –∑–∞–¥–∞—á—É –≤ —Å–æ—Å—Ç–æ—è–Ω–∏—è—Ö `queued|running`.
  - –û—Ç–≤–µ—Ç: `204 No Content` (—Ç–µ–ª–æ: `{"status": "cancelled"}`).
  - –û—à–∏–±–∫–∏: `404` (–Ω–µ—Ç –∑–∞–¥–∞—á–∏), `409` (–Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å –≤ —Ç–µ–∫—É—â–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏).

- GET `/downloads/{task_id}/file`
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–∫–∞—á–∞–Ω–Ω—ã–π —Ñ–∞–π–ª (Content-Disposition —Å –∏–º–µ–Ω–µ–º).
  - –û—à–∏–±–∫–∏: `409 file_not_ready`, `404 task_not_found`, `500 file_missing`.

### –ü—Ä–∏–º–µ—Ä—ã cURL

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
curl http://localhost:8000/health

# –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã
curl -G "http://localhost:8000/formats" --data-urlencode "url=https://www.youtube.com/watch?v=VIDEO_ID"

# –°—Ç–∞—Ä—Ç –∑–∞–≥—Ä—É–∑–∫–∏ (–≤–∏–¥–µ–æ+–∞—É–¥–∏–æ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º format-id –∏–ª–∏ –∏—Ö —Å—É–º–º–æ–π)
curl -X POST "http://localhost:8000/downloads" \
  -H "Content-Type: application/json" \
  -d '{"url":"https://www.youtube.com/watch?v=VIDEO_ID","format":"136+140","audio_only":false}'

# –°—Ç–∞—Ä—Ç –∑–∞–≥—Ä—É–∑–∫–∏ (—Ç–æ–ª—å–∫–æ –∞—É–¥–∏–æ)
curl -X POST "http://localhost:8000/downloads" \
  -H "Content-Type: application/json" \
  -d '{"url":"https://www.youtube.com/watch?v=VIDEO_ID","audio_only":true}'

# –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á
curl http://localhost:8000/downloads

# –°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏
curl http://localhost:8000/downloads/TASK_UUID

# –°–∫–∞—á–∞—Ç—å –∏—Ç–æ–≥–æ–≤—ã–π —Ñ–∞–π–ª
curl -OJ http://localhost:8000/downloads/TASK_UUID/file

# –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–¥–∞—á—É
curl -X DELETE http://localhost:8000/downloads/TASK_UUID
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

- `DOWNLOADS_DIR` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `downloads`) ‚Äî –∫—É–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ñ–∞–π–ª—ã.
- `MAX_CONCURRENT_DOWNLOADS` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `2`) ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫.
- `PROGRESS_UPDATE_INTERVAL_MS` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `500`) ‚Äî —á–∞—Å—Ç–æ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≤ API.
- `CLEANUP_INTERVAL_MIN` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `10`) ‚Äî –∫–∞–∫ —á–∞—Å—Ç–æ –∑–∞–ø—É—Å–∫–∞—Ç—å —Ñ–æ–Ω–æ–≤—É—é –æ—á–∏—Å—Ç–∫—É –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –∑–∞–¥–∞—á.
- `DOWNLOAD_TTL_HOURS` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `24`) ‚Äî TTL –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–∫–∞—á–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏ –∑–∞–ø–∏—Å–µ–π –∑–∞–¥–∞—á (–µ—Å–ª–∏ `PERSIST_DOWNLOADS=false`).
- `PERSIST_DOWNLOADS` (`false`/`true`) ‚Äî –µ—Å–ª–∏ `true`, —Ñ–∞–π–ª—ã –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ TTL.
- `QUEUE_STRATEGY` (`enqueue`/`reject`; –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `enqueue`) ‚Äî –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫.

–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:
- –ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å —à–∞–≥–æ–º `PROGRESS_UPDATE_INTERVAL_MS`, –ø–æ—ç—Ç–æ–º—É –ø—Ä–∏ —á–∞—Å—Ç–æ–º –æ–ø—Ä–æ—Å–µ –∫–ª–∏–µ–Ω—Ç–∞ –∑–Ω–∞—á–µ–Ω–∏—è –º–æ–≥—É—Ç –º–µ–Ω—è—Ç—å—Å—è –Ω–µ –Ω–∞ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å.
- –ï—Å–ª–∏ `QUEUE_STRATEGY=reject`, –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–≥—Ä—É–∑–∫—É —Å–≤–µ—Ä—Ö –ª–∏–º–∏—Ç–∞ API –≤–µ—Ä–Ω—ë—Ç `429` —Å `max_concurrent`.
- CORS –æ—Ç–∫—Ä—ã—Ç –∫–æ –≤—Å–µ–º –¥–æ–º–µ–Ω–∞–º ‚Äî –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ–≥—Ä–∞–Ω–∏—á—å—Ç–µ –≤ `api.main`.

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏

- –î–ª—è –≤—ã–±–æ—Ä–∞ `format` –ø–æ–ª—É—á–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö format-id —á–µ—Ä–µ–∑ `/formats` (–ø–æ–ª–µ `formats`) –∏ –ø–æ–¥–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â—É—é –∫–æ–º–±–∏–Ω–∞—Ü–∏—é `video+audio`.
- –î–ª—è –∞—É–¥–∏–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `audio_only=true` ‚Äî —Å–µ—Ä–≤–µ—Ä —Å–∞–º –≤—ã–±–µ—Ä–µ—Ç –Ω–∞–¥—ë–∂–Ω—ã–π –∞—É–¥–∏–æ—Ñ–æ—Ä–º–∞—Ç.
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–æ–ª–ª–∏–Ω–≥ `/downloads/{id}` –¥–æ `state=completed`, –∑–∞—Ç–µ–º —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ `/downloads/{id}/file`.

## FAQ/–¢—Ä–∞–±–ª—à—É—Ç–∏–Ω–≥

- 403 / ‚ÄúFailed to parse JSON‚Äù: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ cookies, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –∞–∫–∫–∞—É–Ω—Ç/—Ä–µ–≥–∏–æ–Ω.
- ‚ÄúERROR: ‚Ä¶‚Äù –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è: –≤ CLI —ç—Ç–æ –ø–æ–¥–∞–≤–ª–µ–Ω–æ, –µ—Å–ª–∏ –≤–∏–¥–∏—Ç–µ ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–ø—É—Å–∫ –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞.
- yt-dlp —É—Å—Ç–∞—Ä–µ–ª/—Å–ª–æ–º–∞–ª—Å—è: –æ–±–Ω–æ–≤–∏—Ç–µ `yt-dlp` –≤ venv (`pip install -U yt-dlp`) –∏–ª–∏ –ø–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ Docker.
- UI –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è/–ø–æ—Ä—Ç –∑–∞–Ω—è—Ç: –∑–∞–ø—É—Å—Ç–∏—Ç–µ –Ω–∞ –¥—Ä—É–≥–æ–º –ø–æ—Ä—Ç—É, –Ω–∞–ø—Ä–∏–º–µ—Ä `streamlit run ui/app.py --server.port=8502` –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:8502`.

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
